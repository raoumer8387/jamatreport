<!DOCTYPE html>
<html lang="ur" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>تاریخی ڈیٹا جمع کریں - {{ zila }}</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}?v={{ time }}">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Nastaliq+Urdu:wght@400;700&display=swap" rel="stylesheet">
</head>
<body>
    <div class="container">
        <header class="report-header">
            <div class="header-content">
                <h1>جماعت اسلامی ضلعی رپورٹنگ سسٹم</h1>
                <h2>{{ zila }} - تاریخی ڈیٹا جمع کریں</h2>
            </div>
            <div class="header-actions">
                <a href="{{ url_for('historical_data_form', zila=zila) }}" class="back-btn">تاریخی ڈیٹا صفحہ پر واپس جائیں</a>
                <a href="{{ url_for('dashboard') }}" class="back-btn">ڈیش بورڈ پر واپس جائیں</a>
                <a href="{{ url_for('logout') }}" class="logout-btn">لاگ آؤٹ</a>
            </div>
        </header>

        <form method="POST" class="report-form" action="{{ url_for('submit_historical_data', zila=zila) }}" id="historicalForm">
            <!-- Period Selection -->
            <div class="form-section" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); padding: 20px; border-radius: 12px; margin-bottom: 25px; box-shadow: 0 4px 15px rgba(0,0,0,0.1);">
                <h3 class="section-title" style="margin-top: 0; color: white; text-align: center; font-size: 1.4em; margin-bottom: 20px; text-shadow: 0 2px 4px rgba(0,0,0,0.3);">
                    {% if editing %}
                        سہ ماہی اور سال (موجودہ ریکارڈ)
                    {% else %}
                        سہ ماہی اور سال (پچھلا سہ ماہی خودکار طور پر طے شدہ)
                    {% endif %}
                </h3>
                <div class="form-row" style="display: flex; gap: 20px; justify-content: center;">
                    <div class="form-group" style="flex: 1; max-width: 300px;">
                        <label for="quarter" style="color: white; font-weight: bold; margin-bottom: 8px; display: block;">سہ ماہی:</label>
                        <select name="quarter" id="quarter" required disabled style="width: 100%; padding: 12px 15px; border: 2px solid rgba(255,255,255,0.3); border-radius: 8px; background-color: rgba(255,255,255,0.9); color: #333; font-size: 16px; font-weight: 500; cursor: not-allowed; transition: all 0.3s ease;">
                            <option value="Q1" {% if form_data.get('quarter') == 'Q1' %}selected{% endif %}>پہلا سہ ماہی (Q1)</option>
                            <option value="Q2" {% if form_data.get('quarter') == 'Q2' %}selected{% endif %}>دوسرا سہ ماہی (Q2)</option>
                            <option value="Q3" {% if form_data.get('quarter') == 'Q3' %}selected{% endif %}>تیسرا سہ ماہی (Q3)</option>
                            <option value="Q4" {% if form_data.get('quarter') == 'Q4' %}selected{% endif %}>چوتھا سہ ماہی (Q4)</option>
                        </select>
                        {% if editing %}
                        <small style="color: rgba(255,255,255,0.8); font-size: 12px; margin-top: 5px; display: block;">موجودہ ریکارڈ کا سہ ماہی - ترمیم نہیں کی جا سکتی</small>
                        {% endif %}
                    </div>
                    <div class="form-group" style="flex: 1; max-width: 300px;">
                        <label for="year" style="color: white; font-weight: bold; margin-bottom: 8px; display: block;">سال:</label>
                        <select name="year" id="year" required disabled style="width: 100%; padding: 12px 15px; border: 2px solid rgba(255,255,255,0.3); border-radius: 8px; background-color: rgba(255,255,255,0.9); color: #333; font-size: 16px; font-weight: 500; cursor: not-allowed; transition: all 0.3s ease;">
                            <option value="2023" {% if form_data.get('year') == '2023' %}selected{% endif %}>2023</option>
                            <option value="2024" {% if form_data.get('year') == '2024' %}selected{% endif %}>2024</option>
                            <option value="2025" {% if form_data.get('year') == '2025' %}selected{% endif %}>2025</option>
                            <option value="2026" {% if form_data.get('year') == '2026' %}selected{% endif %}>2026</option>
                        </select>
                        {% if editing %}
                        <small style="color: rgba(255,255,255,0.8); font-size: 12px; margin-top: 5px; display: block;">موجودہ ریکارڈ کا سال - ترمیم نہیں کی جا سکتی</small>
                        {% endif %}
                    </div>
                </div>
                {% if editing %}
                <div style="margin-top: 10px; padding: 10px; background-color: #fff3cd; border-radius: 5px; border-left: 4px solid #ffc107;">
                    <strong>نوٹ:</strong> آپ موجودہ ریکارڈ کو ترمیم کر رہے ہیں۔ سہ ماہی اور سال تبدیل نہیں کیے جا سکتے۔
                </div>
                {% endif %}
                
                <!-- Hidden inputs to ensure quarter and year are always submitted -->
                <input type="hidden" name="quarter" value="{{ form_data.get('quarter', '') }}">
                <input type="hidden" name="year" value="{{ form_data.get('year', '') }}">
            </div>
            <!-- ابتدائی معلومات -->
            <div class="form-section">
                <h3 class="section-title">ابتدائی معلومات</h3>
                
                <div class="form-row">
                    <div class="form-group">
                        <label>تعداد یونین کمیٹی </label>
                        <input type="number" name="union_committee_count" value="{{ form_data.get('union_committee_count', '') }}">
                    </div>
                    <div class="form-group">
                        <label for="nazm-qaim-union">نظم قائم </label>
                        <input type="number" id="nazm_qaim_union" name="nazm_qaim_union" min="0" value="{{ form_data.get('nazm_qaim_union', '') }}" placeholder="0">
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label>تعداد وارڈز </label>
                        <input type="number" name="wards_count" value="{{ form_data.get('wards_count', '') }}">
                    </div>
                    <div class="form-group">
                        <label for="nazm-qaim-wards">نظم قائم </label>
                        <input type="number" id="nazm_qaim_wards" name="nazm_qaim_wards" min="0" value="{{ form_data.get('nazm_qaim_wards', '') }}" placeholder="0">
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label>تعداد بلاک کوڈ </label>
                        <input type="number" name="block_code_count" value="{{ form_data.get('block_code_count', '') }}">
                    </div>
                    <div class="form-group">
                        <label for="nazm-qaim-blockcode">نظم قائم </label>
                        <input type="number" id="nazm_qaim_blockcode" name="nazm_qaim_blockcode" min="0" value="{{ form_data.get('nazm_qaim_blockcode', '') }}" placeholder="0">
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label>تعداد کنٹونمنٹ وارڈز </label>
                        <input type="number" name="cantonment_board_count" value="{{ form_data.get('cantonment_board_count', '') }}">
                    </div>
                    <div class="form-group">
                        <label for="nazm-qaim-cantonment">نظم قائم </label>
                        <input type="number" id="nazm_qaim_cantonment" name="nazm_qaim_cantonment" min="0" value="{{ form_data.get('nazm_qaim_cantonment', '') }}" placeholder="0">
                    </div>
                </div>
            </div>

            <!-- تنظیمی ہیٔت -->
            <div class="form-section">
                <h3 class="section-title">تنظیمی ہیٔت</h3>
                <table class="organizational-table">
                    <thead>
                        <tr>
                            <th></th>
                            <th>ہدف(سالانہ)</th>
                            <th>آغاز</th>
                            <th>اضافہ</th>
                            <th>کمی</th>
                            <th>اختتام</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for key in [
                            ['alaqajat', 'علاقہ جات'],
                            ['halqajat', 'حلقہ جات'],
                            ['halqajat_ward', 'کتنے حلقہ جات وارڈ کی سطح پر قائم ہیں'],
                            ['block_code', 'بلاک کوڈ انچارجز'],
                            ['nizam_e_fajar', 'نظام فجر'],
                            ['awaami_committee', 'عوامی کمیٹی']
                        ] %}
                        <tr>
                            <td>{{ key[1] }}</td>
                            <td class="prev-value">
                                <input type="number" class="input-field" name="{{ key[0] }}_target" value="{{ form_data.get(key[0] ~ '_target', '') }}">
                            </td>
                            <td class="prev-value">
                                <input type="number" 
                                       class="input-field" 
                                       name="{{ key[0] }}_start" 
                                       value="{{ form_data.get(key[0] ~ '_start', '') }}"
                                       {% if form_data.get(key[0] ~ '_start', '') and not editing %}readonly style="background-color: #f8f9fa; color: #6c757d;"{% endif %}>
                            </td>
                            <td>
                                <input type="number" class="input-field" name="{{ key[0] }}_izafa" value="{{ form_data.get(key[0] ~ '_izafa', '') }}">
                            </td>
                            <td>
                                <input type="number" class="input-field" name="{{ key[0] }}_kami" value="{{ form_data.get(key[0] ~ '_kami', '') }}">
                            </td>
                            <td class="calculated-value" id="{{ key[0] }}-ikhtitaam">
                              <input type="number"
                                     name="{{ key[0] }}_ikhtitaam"
                                     id="{{ key[0] }}_ikhtitaam_input"
                                     value="{% if form_data.get(key[0] ~ '_ikhtitaam') is not none %}{{ form_data.get(key[0] ~ '_ikhtitaam') }}{% else %}{{ (form_data.get(key[0] ~ '_start', 0) | int) + (form_data.get(key[0] ~ '_izafa', 0) | int) - (form_data.get(key[0] ~ '_kami', 0) | int) }}{% endif %}"
                                     readonly>
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>

            <!-- افرادی قوت -->
            <div class="form-section">
                <h3 class="section-title">افرادی قوت</h3>
                <table class="organizational-table">
                    <thead>
                        <tr>
                            <th></th>
                            <th>ہدف(سہ ماہی)</th>
                            <th>آغاز</th>
                            <th>اضافہ</th>
                            <th>کمی</th>
                            <th>اختتام</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for key in [
                            ['arkaan', 'ارکان'],
                            ['umeedwaran', 'امیدواران رکنیت'],
                            ['karkunan', 'کارکنان'],
                            ['hangami', 'ہنگامی/ دیگر کارکنان'],
                            ['muawanin', 'معاونین'],
                            ['mutayyin_afrad', 'متعین افراد'],
                            ['member', 'ممبران']
                        ] %}
                        <tr>
                            <td>{{ key[1] }}</td>
                            <td class="prev-value">
                                <input type="number" class="input-field" name="{{ key[0] }}_target" value="{{ form_data.get(key[0] ~ '_target', '') }}">
                            </td>
                            <td class="prev-value">
                                <input type="number" 
                                       class="input-field" 
                                       name="{{ key[0] }}_start" 
                                       value="{{ form_data.get(key[0] ~ '_start', '') }}"
                                       {% if form_data.get(key[0] ~ '_start', '') and not editing %}readonly style="background-color: #f8f9fa; color: #6c757d;"{% endif %}>
                            </td>
                            <td>
                                <input type="number" class="input-field" name="{{ key[0] }}_izafa" value="{{ form_data.get(key[0] ~ '_izafa', '') }}">
                            </td>
                            <td>
                                <input type="number" class="input-field" name="{{ key[0] }}_kami" value="{{ form_data.get(key[0] ~ '_kami', '') }}">
                            </td>
                            <td class="calculated-value" id="{{ key[0] }}-ikhtitaam">
                              <input type="number"
                                     name="{{ key[0] }}_ikhtitaam"
                                     id="{{ key[0] }}_ikhtitaam_input"
                                     value="{% if form_data.get(key[0] ~ '_ikhtitaam') is not none %}{{ form_data.get(key[0] ~ '_ikhtitaam') }}{% else %}{{ (form_data.get(key[0] ~ '_start', 0) | int) + (form_data.get(key[0] ~ '_izafa', 0) | int) - (form_data.get(key[0] ~ '_kami', 0) | int) }}{% endif %}"
                                     readonly>
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>

            <!-- جماعت اسلامی یوتھ -->
            <div class="form-section">
                <h3 class="section-title">جماعت اسلامی یوتھ</h3>
                <div class="form-row">
                    <div class="form-group">
                        <label for="youth-nazm-areas">کتنے علاقہ میں نظم قائم ہے:</label>
                        <input type="number" id="youth-nazm-areas" name="youth_nazm_areas" min="0" placeholder="0" value="{{ form_data.get('youth_nazm_areas', '') }}">
                    </div>
                    <div class="form-group">
                        <label for="youth-karkunan">کارکنان کی تعداد:</label>
                        <input type="number" id="youth-karkunan" name="youth_karkunan" min="0" placeholder="0" value="{{ form_data.get('youth_karkunan', '') }}">
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label for="youth_programat_count">پروگرامات کی تعداد:</label>
                        <input type="number" id="youth_programat_count" name="youth_programat_count" min="0" max="50" value="{{ form_data.get('youth_programat_count', '') }}" placeholder="0" oninput="renderProgramatFields()">
                    </div>
                </div>
                <div id="programat-fields-container">
                    {% if form_data.get('youth_programat_count', '') and form_data.get('youth_programat_count', 0)|int > 0 %}
                        {% for i in range(form_data.get('youth_programat_count', 0)|int) %}
                        <div class="form-row programat-row">
                            <div class="form-group">
                                <label for="programat_{{i+1}}">نوعیت {{i+1}}</label>
                                <input type="text" id="programat_{{i+1}}" name="programat_{{i+1}}" value="{{ form_data.get('programat_' ~ (i+1), '') }}" placeholder="نوعیت">
                            </div>
                            <div class="form-group">
                                <label for="programat_count_{{i+1}}">حاضری</label>
                                <input type="number" id="programat_count_{{i+1}}" name="programat_count_{{i+1}}" min="0" value="{{ form_data.get('programat_count_' ~ (i+1), '') }}" placeholder="0">
                            </div>
                        </div>
                        {% endfor %}
                    {% endif %}
                </div>
            </div>

            <!-- جماعتِ اسلامی شعبہ اطفال -->
            <div class="form-section atifal-section">
                <h3 class="section-title">جماعتِ اسلامی شعبہ اطفال</h3>
                <div class="form-row single-column-row">
                    <div class="form-group">
                        <label for="atifal-nazm-areas">کتنے علاقہ میں نظم قائم ہے:</label>
                        <input type="number" id="atifal-nazm-areas" name="atifal_nazm_areas" min="0" placeholder="0" value="{{ form_data.get('atifal_nazm_areas', '') }}">
                    </div>
                </div>
                <div class="form-row single-column-row">
                    <div class="form-group">
                        <label for="atifal_programat_count">پروگرامات کی تعداد:</label>
                        <input type="number" id="atifal_programat_count" name="atifal_programat_count" min="0" max="50" value="{{ form_data.get('atifal_programat_count', '') }}" placeholder="0" oninput="renderAtifalProgramatFields()">
                    </div>
                </div>
                <div id="atifal-programat-fields-container">
                    {% if form_data.get('atifal_programat_count', '') and form_data.get('atifal_programat_count', 0)|int > 0 %}
                        {% for i in range(form_data.get('atifal_programat_count', 0)|int) %}
                        <div class="form-row programat-row">
                            <div class="form-group">
                                <label for="atifal_nauyiat_{{i+1}}">نوعیت {{i+1}}</label>
                                <input type="text" id="atifal_nauyiat_{{i+1}}" name="atifal_nauyiat_{{i+1}}" value="{{ form_data.get('atifal_nauyiat_' ~ (i+1), '') }}" placeholder="0">
                            </div>
                            <div class="form-group">
                                <label for="atifal_programat_count_{{i+1}}">حاضری</label>
                                <input type="number" id="atifal_programat_count_{{i+1}}" name="atifal_programat_count_{{i+1}}" min="0" value="{{ form_data.get('atifal_programat_count_' ~ (i+1), '') }}" placeholder="0">
                            </div>
                        </div>
                        {% endfor %}
                    {% endif %}
                </div>
            </div>

            <!-- ضلعی تنظیمی اجتماعات -->
            <div class="form-section">
                <h3 class="section-title">ضلعی تنظیمی اجتماعات</h3>
                <table class="organizational-table">
                    <thead>
                        <tr>
                            <th></th>
                            <th>طے شدہ</th>
                            <th>ہوئے</th>
                            <th>حاضری</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>اجلاس ضلعی شوریٰ</td>
                            <td><input type="number" class="input-field" id="zilai-shura-planned" name="zilai_shura_planned" min="0" placeholder="0" value="{{ form_data.get('zilai_shura_planned', '') }}"></td>
                            <td><input type="number" class="input-field" id="zilai-shura-held" name="zilai_shura_held" min="0" placeholder="0" value="{{ form_data.get('zilai_shura_held', '') }}"></td>
                            <td><input type="number" class="input-field" id="zilai-shura-attendance" name="zilai_shura_attendance" min="0" placeholder="0" value="{{ form_data.get('zilai_shura_attendance', '') }}"></td>
                        </tr>
                        <tr>
                            <td>اجلاس نظم ضلع</td>
                            <td><input type="number" class="input-field" id="nazm-zila-planned" name="nazm_zila_planned" min="0" placeholder="0" value="{{ form_data.get('nazm_zila_planned', '') }}"></td>
                            <td><input type="number" class="input-field" id="nazm-zila-held" name="nazm_zila_held" min="0" placeholder="0" value="{{ form_data.get('nazm_zila_held', '') }}"></td>
                            <td><input type="number" class="input-field" id="nazm-zila-attendance" name="nazm_zila_attendance" min="0" placeholder="0" value="{{ form_data.get('nazm_zila_attendance', '') }}"></td>
                        </tr>
                        <tr>
                            <td>اجلاس ناظمین علاقہ جات</td>
                            <td><input type="number" class="input-field" id="nazimin-alaqajat-planned" name="nazimin_alaqajat_planned" min="0" placeholder="0" value="{{ form_data.get('nazimin_alaqajat_planned', '') }}"></td>
                            <td><input type="number" class="input-field" id="nazimin-alaqajat-held" name="nazimin_alaqajat_held" min="0" placeholder="0" value="{{ form_data.get('nazimin_alaqajat_held', '') }}"></td>
                            <td><input type="number" class="input-field" id="nazimin-alaqajat-attendance" name="nazimin_alaqajat_attendance" min="0" placeholder="0" value="{{ form_data.get('nazimin_alaqajat_attendance', '') }}"></td>
                        </tr>
                        <tr>
                            <td>ضلعی اجتماع ارکان</td>
                            <td><input type="number" class="input-field" id="zilai-ijtima-arkaan-planned" name="zilai_ijtima_arkaan_planned" min="0" placeholder="0" value="{{ form_data.get('zilai_ijtima_arkaan_planned', '') }}"></td>
                            <td><input type="number" class="input-field" id="zilai-ijtima-arkaan-held" name="zilai_ijtima_arkaan_held" min="0" placeholder="0" value="{{ form_data.get('zilai_ijtima_arkaan_held', '') }}"></td>
                            <td><input type="number" class="input-field" id="zilai-ijtima-arkaan-attendance" name="zilai_ijtima_arkaan_attendance" min="0" placeholder="0" value="{{ form_data.get('zilai_ijtima_arkaan_attendance', '') }}"></td>
                        </tr>
                        <tr>
                            <td>ضلعی اجتماع امیدواران</td>
                            <td><input type="number" class="input-field" id="zilai-ijtima-umeedwaran-planned" name="zilai_ijtima_umeedwaran_planned" min="0" placeholder="0" value="{{ form_data.get('zilai_ijtima_umeedwaran_planned', '') }}"></td>
                            <td><input type="number" class="input-field" id="zilai-ijtima-umeedwaran-held" name="zilai_ijtima_umeedwaran_held" min="0" placeholder="0" value="{{ form_data.get('zilai_ijtima_umeedwaran_held', '') }}"></td>
                            <td><input type="number" class="input-field" id="zilai-ijtima-umeedwaran-attendance" name="zilai_ijtima_umeedwaran_attendance" min="0" placeholder="0" value="{{ form_data.get('zilai_ijtima_umeedwaran_attendance', '') }}"></td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <!-- تنظیمی اجتماعات -->
            <div class="form-section">
                <h3 class="section-title">تنظیمی اجتماعات</h3>
                <table class="organizational-table">
                    <thead>
                        <tr>
                            <th></th>
                            <th>طے شدہ</th>
                            <th>ہوئے</th>
                            <th>حاضری</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>اجتماع ارکان (علاقہ )</td>
                            <td><input type="number" class="input-field" id="ijtima-arkaan-alaqah-planned" name="ijtima_arkaan_alaqah_planned" min="0" placeholder="0" value="{{ form_data.get('ijtima_arkaan_alaqah_planned', '') }}"></td>
                            <td><input type="number" class="input-field" id="ijtima-arkaan-alaqah-held" name="ijtima_arkaan_alaqah_held" min="0" placeholder="0" value="{{ form_data.get('ijtima_arkaan_alaqah_held', '') }}"></td>
                            <td><input type="number" class="input-field" id="ijtima-arkaan-alaqah-attendance" name="ijtima_arkaan_alaqah_attendance" min="0" placeholder="0" value="{{ form_data.get('ijtima_arkaan_alaqah_attendance', '') }}"></td>
                        </tr>
                        <tr>
                            <td>اجتماع اُمیدواران (علاقہ )</td>
                            <td><input type="number" class="input-field" id="ijtima-umeedwaran-alaqah-planned" name="ijtima_umeedwaran_alaqah_planned" min="0" placeholder="0" value="{{ form_data.get('ijtima_umeedwaran_alaqah_planned', '') }}"></td>
                            <td><input type="number" class="input-field" id="ijtima-umeedwaran-alaqah-held" name="ijtima_umeedwaran_alaqah_held" min="0" placeholder="0" value="{{ form_data.get('ijtima_umeedwaran_alaqah_held', '') }}"></td>
                            <td><input type="number" class="input-field" id="ijtima-umeedwaran-alaqah-attendance" name="ijtima_umeedwaran_alaqah_attendance" min="0" placeholder="0" value="{{ form_data.get('ijtima_umeedwaran_alaqah_attendance', '') }}"></td>
                        </tr>
                        <tr>
                            <td>اجتماع کارکنان (علاقہ )</td>
                            <td><input type="number" class="input-field" id="ijtima-karkunaan-alaqah-planned" name="ijtima_karkunaan_alaqah_planned" min="0" placeholder="0" value="{{ form_data.get('ijtima_karkunaan_alaqah_planned', '') }}"></td>
                            <td><input type="number" class="input-field" id="ijtima-karkunaan-alaqah-held" name="ijtima_karkunaan_alaqah_held" min="0" placeholder="0" value="{{ form_data.get('ijtima_karkunaan_alaqah_held', '') }}"></td>
                            <td><input type="number" class="input-field" id="ijtima-karkunaan-alaqah-attendance" name="ijtima_karkunaan_alaqah_attendance" min="0" placeholder="0" value="{{ form_data.get('ijtima_karkunaan_alaqah_attendance', '') }}"></td>
                        </tr>
                        <tr>
                            <td>اجتماع کارکنان (حلقہ جات )</td>
                            <td><input type="number" class="input-field" id="ijtima-karkunaan-halqajat-planned" name="ijtima_karkunaan_halqajat_planned" min="0" placeholder="0" value="{{ form_data.get('ijtima_karkunaan_halqajat_planned', '') }}"></td>
                            <td><input type="number" class="input-field" id="ijtima-karkunaan-halqajat-held" name="ijtima_karkunaan_halqajat_held" min="0" placeholder="0" value="{{ form_data.get('ijtima_karkunaan_halqajat_held', '') }}"></td>
                            <td><input type="number" class="input-field" id="ijtima-karkunaan-halqajat-attendance" name="ijtima_karkunaan_halqajat_attendance" min="0" placeholder="0" value="{{ form_data.get('ijtima_karkunaan_halqajat_attendance', '') }}"></td>
                        </tr>
                        <tr>
                            <td>اجتماع ناظمین (حلقہ جات)</td>
                            <td><input type="number" class="input-field" id="ijtima-nazimin-halqajat-planned" name="ijtima_nazimin_halqajat_planned" min="0" placeholder="0" value="{{ form_data.get('ijtima_nazimin_halqajat_planned', '') }}"></td>
                            <td><input type="number" class="input-field" id="ijtima-nazimin-halqajat-held" name="ijtima_nazimin_halqajat_held" min="0" placeholder="0" value="{{ form_data.get('ijtima_nazimin_halqajat_held', '') }}"></td>
                            <td><input type="number" class="input-field" id="ijtima-nazimin-halqajat-attendance" name="ijtima_nazimin_halqajat_attendance" min="0" placeholder="0" value="{{ form_data.get('ijtima_nazimin_halqajat_attendance', '') }}"></td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <!-- دعوتی اجتماعات -->
            <div class="form-section">
                <h3 class="section-title">دعوتی اجتماعات</h3>
                <table class="organizational-table">
                    <thead>
                        <tr>
                            <th></th>
                            <th>طے شدہ</th>
                            <th>ہوئے</th>
                            <th>حاضری</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>درس قرآن (حلقہ جات )</td>
                            <td><input type="number" class="input-field" id="dars-quran-planned" name="dars_quran_planned" min="0" placeholder="0" value="{{ form_data.get('dars_quran_planned', '') }}"></td>
                            <td><input type="number" class="input-field" id="dars-quran-held" name="dars_quran_held" min="0" placeholder="0" value="{{ form_data.get('dars_quran_held', '') }}"></td>
                            <td><input type="number" class="input-field" id="dars-quran-attendance" name="dars_quran_attendance" min="0" placeholder="0" value="{{ form_data.get('dars_quran_attendance', '') }}"></td>
                        </tr>
                        <tr>
                            <td>دعوتی کیمپ / مستقل و فود</td>
                            <td><input type="number" class="input-field" id="dawati-camp-planned" name="dawati_camp_planned" min="0" placeholder="0" value="{{ form_data.get('dawati_camp_planned', '') }}"></td>
                            <td><input type="number" class="input-field" id="dawati-camp-held" name="dawati_camp_held" min="0" placeholder="0" value="{{ form_data.get('dawati_camp_held', '') }}"></td>
                            <td><input type="number" class="input-field" id="dawati-camp-attendance" name="dawati_camp_attendance" min="0" placeholder="0" value="{{ form_data.get('dawati_camp_attendance', '') }}"></td>
                        </tr>
                        <tr>
                            <td>گھروں تک دعوت</td>
                            <td><input type="number" class="input-field" id="gharon-tak-dawat-planned" name="gharon_tak_dawat_planned" min="0" placeholder="0" value="{{ form_data.get('gharon_tak_dawat_planned', '') }}"></td>
                            <td><input type="number" class="input-field" id="gharon-tak-dawat-held" name="gharon_tak_dawat_held" min="0" placeholder="0" value="{{ form_data.get('gharon_tak_dawat_held', '') }}"></td>
                            <td><input type="number" class="input-field" id="gharon-tak-dawat-attendance" name="gharon_tak_dawat_attendance" min="0" placeholder="0" value="{{ form_data.get('gharon_tak_dawat_attendance', '') }}"></td>
                        </tr>
                        <tr>
                            <td>تقسیم دعوتی لٹریچر</td>
                            <td><input type="number" class="input-field" id="taqseem-literature-planned" name="taqseem_literature_planned" min="0" placeholder="0" value="{{ form_data.get('taqseem_literature_planned', '') }}"></td>
                            <td><input type="number" class="input-field" id="taqseem-literature-held" name="taqseem_literature_held" min="0" placeholder="0" value="{{ form_data.get('taqseem_literature_held', '') }}"></td>
                            <td><input type="number" class="input-field" id="taqseem-literature-attendance" name="taqseem_literature_attendance" min="0" placeholder="0" value="{{ form_data.get('taqseem_literature_attendance', '') }}"></td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <!-- تربیتی اِجتماعات -->
            <div class="form-section">
                <h3 class="section-title">تربیتی اِجتماعات</h3>
                <table class="organizational-table">
                    <thead>
                        <tr>
                            <th></th>
                            <th>مقامات</th>
                            <th>دورہ جات</th>
                            <th>حاضری اوسطاً</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>اسٹڈی سرکل/ ڈسکشن</td>
                            <td><input type="number" class="input-field" id="study-circle-maqamat" name="study_circle_maqamat" min="0" placeholder="0" value="{{ form_data.get('study_circle_maqamat', '') }}"></td>
                            <td><input type="number" class="input-field" id="study-circle-daurajat" name="study_circle_daurajat" min="0" placeholder="0" value="{{ form_data.get('study_circle_daurajat', '') }}"></td>
                            <td><input type="number" class="input-field" id="study-circle-attendance" name="study_circle_attendance" min="0" placeholder="0" value="{{ form_data.get('study_circle_attendance', '') }}"></td>
                        </tr>
                        <tr>
                            <td>اجتماعی طعام</td>
                            <td><input type="number" class="input-field" id="ijtimai-tuaam-maqamat" name="ijtimai_tuaam_maqamat" min="0" placeholder="0" value="{{ form_data.get('ijtimai_tuaam_maqamat', '') }}"></td>
                            <td><input type="number" class="input-field" id="ijtimai-tuaam-daurajat" name="ijtimai_tuaam_daurajat" min="0" placeholder="0" value="{{ form_data.get('ijtimai_tuaam_daurajat', '') }}"></td>
                            <td><input type="number" class="input-field" id="ijtimai-tuaam-attendance" name="ijtimai_tuaam_attendance" min="0" placeholder="0" value="{{ form_data.get('ijtimai_tuaam_attendance', '') }}"></td>
                        </tr>
                        <tr>
                            <td>اجتماعی اہل خانہ</td>
                            <td><input type="number" class="input-field" id="ijtimai-ahle-khana-maqamat" name="ijtimai_ahle_khana_maqamat" min="0" placeholder="0" value="{{ form_data.get('ijtimai_ahle_khana_maqamat', '') }}"></td>
                            <td><input type="number" class="input-field" id="ijtimai-ahle-khana-daurajat" name="ijtimai_ahle_khana_daurajat" min="0" placeholder="0" value="{{ form_data.get('ijtimai_ahle_khana_daurajat', '') }}"></td>
                            <td><input type="number" class="input-field" id="ijtimai-ahle-khana-attendance" name="ijtimai_ahle_khana_attendance" min="0" placeholder="0" value="{{ form_data.get('ijtimai_ahle_khana_attendance', '') }}"></td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <!-- مرکز قرآن و سنہ -->
            <div class="form-section">
                <h3 class="section-title">مرکز قرآن و سنہ</h3>
                <div class="form-row single-column-row">
                    <div class="form-group">
                        <label for="quran-courses">کورسز</label>
                        <input type="number" id="quran-courses" name="quran_courses" min="0" value="{{ form_data.get('quran_courses', '') }}" placeholder="0">
                    </div>
                </div>
                <div class="form-row single-column-row">
                    <div class="form-group">
                        <label for="quran-classes">کلاس</label>
                        <input type="number" id="quran-classes" name="quran_classes" min="0" value="{{ form_data.get('quran_classes', '') }}" placeholder="0">
                    </div>
                </div>
                <div class="form-row single-column-row">
                    <div class="form-group">
                        <label for="quran-participants">شرکاء</label>
                        <input type="number" id="quran-participants" name="quran_participants" min="0" value="{{ form_data.get('quran_participants', '') }}" placeholder="0">
                    </div>
                </div>
                <div class="form-row single-column-row">
                    <div class="form-group">
                        <label for="fahem-quran-attendance">فہم القرآن پروگرام (حاضری)</label>
                        <input type="number" id="fahem-quran-attendance" name="fahem_quran_attendance" min="0" value="{{ form_data.get('fahem_quran_attendance', '') }}" placeholder="0">
                    </div>
                </div>
                <div class="form-row single-column-row">
                    <div class="form-group">
                        <label for="quran-distributed">تقسیم ترجمه قرآن</label>
                        <input type="number" id="quran-distributed" name="quran_distributed" min="0" value="{{ form_data.get('quran_distributed', '') }}" placeholder="0">
                    </div>
                </div>
            </div>

            <!-- تربیتی و دیگر سرگرمیاں -->
            <div class="form-section">
                <h3 class="section-title">تربیتی و دیگر سرگرمیاں</h3>
                <div class="form-row">
                    <div class="form-group">
                        <label for="central-training-target">مرکزی تربیت گاہ (حاضری کا ہدف)</label>
                        <input type="number" id="central_training_target" name="central_training_target" min="0" value="{{ form_data.get('central_training_target', '') }}" placeholder="0">
                    </div>
                    <div class="form-group">
                        <label for="central-training-actual">شرکت</label>
                        <input type="number" id="central_training_actual" name="central_training_actual" min="0" value="{{ form_data.get('central_training_actual', '') }}" placeholder="0">
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label for="other-trainings">دیگر تربیتی اجتماعات (ضلعی تربیت گاہ، شب بیداریاں وغیرہ)</label>
                        <input type="text" id="other_trainings" name="other_trainings" placeholder="" value="{{ form_data.get('other_trainings', '') }}">
                    </div>
                    <div class="form-group">
                        <label for="atifal-programs">حاضری</label>
                        <input type="number" id="atifal_programs" name="atifal_programs" min="0" placeholder="0" value="{{ form_data.get('atifal_programs', '') }}">
                    </div>
                </div>
            </div>

            <!-- ذمہ داران -->
            <div class="form-section">
                <h3 class="section-title">ذمہ داران</h3>
                <table class="organizational-table">
                    <thead>
                        <tr>
                            <th></th>
                            <th>مقامات</th>
                            <th>دورہ جات</th>
                            <th>انفرادی ملاقاتیں</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>امیر ضلع</td>
                            <td><input type="number" class="input-field" id="amir_zila_maqamat" name="amir_zila_maqamat" min="0" placeholder="0" value="{{ form_data.get('amir_zila_maqamat', '') }}"></td>
                            <td><input type="number" class="input-field" id="amir_zila_daurajat" name="amir_zila_daurajat" min="0" placeholder="0" value="{{ form_data.get('amir_zila_daurajat', '') }}"></td>
                            <td><input type="number" class="input-field" id="amir_zila_mulaqat" name="amir_zila_mulaqat" min="0" placeholder="0" value="{{ form_data.get('amir_zila_mulaqat', '') }}"></td>
                        </tr>
                        <tr>
                            <td>قیم ضلع</td>
                            <td><input type="number" class="input-field" id="qaim_zila_maqamat" name="qaim_zila_maqamat" min="0" placeholder="0" value="{{ form_data.get('qaim_zila_maqamat', '') }}"></td>
                            <td><input type="number" class="input-field" id="qaim_zila_daurajat" name="qaim_zila_daurajat" min="0" placeholder="0" value="{{ form_data.get('qaim_zila_daurajat', '') }}"></td>
                            <td><input type="number" class="input-field" id="qaim_zila_mulaqat" name="qaim_zila_mulaqat" min="0" placeholder="0" value="{{ form_data.get('qaim_zila_mulaqat', '') }}"></td>
                        </tr>
                        <tr>
                            <td>نائب امیر ضلع</td>
                            <td><input type="number" class="input-field" id="naib_amir_zila_maqamat" name="naib_amir_zila_maqamat" min="0" placeholder="0" value="{{ form_data.get('naib_amir_zila_maqamat', '') }}"></td>
                            <td><input type="number" class="input-field" id="naib_amir_zila_daurajat" name="naib_amir_zila_daurajat" min="0" placeholder="0" value="{{ form_data.get('naib_amir_zila_daurajat', '') }}"></td>
                            <td><input type="number" class="input-field" id="naib_amir_zila_mulaqat" name="naib_amir_zila_mulaqat" min="0" placeholder="0" value="{{ form_data.get('naib_amir_zila_mulaqat', '') }}"></td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <!--حق دو کراچی تحریک-->
            <div class="form-section haq-do-karachi-section">
                <h3 class="section-title">حق دو کراچی تحریک</h3>
                <div class="form-row single-column-row">
                    <div class="form-group">
                        <label for="haq-do-karachi">حق دو کراچی تحریک (عوامی مسائل پر سرگرمیاں) تفصیلات</label>
                        <div class="textarea-container">
                            <textarea 
                                id="haq-do-karachi" 
                                name="haq_do_karachi" 
                                placeholder="حق دو کراچی تحریک"
                                oninput="updateCharCounter(this, 'char-counter-haq')"
                                maxlength="5000"
                            >{{ form_data.get('haq_do_karachi', '') }}</textarea>
                            <div class="char-counter" id="char-counter-haq">0 / 5000</div>
                        </div>
                    </div>
                </div>
            </div>

            <!--کوئی اور بات-->
            <div class="form-section koi-or-bat-section">
                <h3 class="section-title">کوئی اور بات</h3>
                <div class="form-row single-column-row">
                    <div class="form-group">
                        <label for="koi-or-bat">آپ کی اضافی رائے یا تجاویز</label>
                        <div class="textarea-container">
                            <textarea 
                                id="koi-or-bat" 
                                name="koi_or_bat" 
                                placeholder="کوئی اور بات"
                                oninput="updateCharCounter(this, 'char-counter-koi')"
                                maxlength="5000"
                            >{{ form_data.get('koi_or_bat', '') }}</textarea>
                            <div class="char-counter" id="char-counter-koi">0 / 5000</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Submit Button -->
            <div class="form-section" style="text-align: center; margin-top: 30px;">
                <button type="submit" class="submit-btn" style="background: #27ae60; color: white; padding: 12px 30px; border: none; border-radius: 5px; font-size: 16px; cursor: pointer;">
                    تاریخی ڈیٹا جمع کریں
                </button>
            </div>
        </form>
    </div>

    <!-- Scripts -->
    <script>
        function updateIkhtitaam(prefix) {
            var aghaazInput = document.querySelector('[name="' + prefix + '_start"]');
            var izafaInput = document.querySelector('[name="' + prefix + '_izafa"]');
            var kamiInput = document.querySelector('[name="' + prefix + '_kami"]');
            var input = document.getElementById(prefix + '_ikhtitaam_input');

            var aghaaz = 0;
            var izafa = 0;
            var kami = 0;

            if (aghaazInput) {
                aghaaz = aghaazInput.value !== '' ? parseInt(aghaazInput.value) : 0;
            }
            if (izafaInput) {
                izafa = izafaInput.value !== '' ? parseInt(izafaInput.value) : 0;
            }
            if (kamiInput) {
                kami = kamiInput.value !== '' ? parseInt(kamiInput.value) : 0;
            }

            var ikhtitaam = aghaaz + izafa - kami;

            if (input) {
                var wasReadonly = input.readOnly;
                input.readOnly = false;
                input.value = ikhtitaam;
                input.readOnly = wasReadonly;
            }
        }

        function setupIkhtitaamListeners(prefix) {
            var aghaazInput = document.querySelector('[name="' + prefix + '_start"]');
            var izafaInput = document.querySelector('[name="' + prefix + '_izafa"]');
            var kamiInput = document.querySelector('[name="' + prefix + '_kami"]');
            
            [aghaazInput, izafaInput, kamiInput].forEach(function(input) {
                if (input) {
                    input.addEventListener('input', function() { 
                        updateIkhtitaam(prefix); 
                    });
                    input.addEventListener('change', function() { 
                        updateIkhtitaam(prefix); 
                    });
                    input.addEventListener('keyup', function() { 
                        updateIkhtitaam(prefix); 
                    });
                }
            });
            
            updateIkhtitaam(prefix);
        }

        function renderProgramatFields() {
            var countInput = document.getElementById('youth_programat_count');
            var container = document.getElementById('programat-fields-container');
            var count = parseInt(countInput.value) || 0;
            if (count > 50) {
                count = 50;
                countInput.value = 50;
            }

            var existingNames = {};
            var existingCounts = {};
            for (var i = 1; i <= 50; i++) {
                var nameInput = document.getElementById('programat_' + i);
                var countInputField = document.getElementById('programat_count_' + i);
                if (nameInput) existingNames[i] = nameInput.value;
                if (countInputField) existingCounts[i] = countInputField.value;
            }

            container.innerHTML = '';
            for (var i = 1; i <= count; i++) {
                var row = document.createElement('div');
                row.className = 'form-row programat-row';
                
                var group1 = document.createElement('div');
                group1.className = 'form-group';
                var label1 = document.createElement('label');
                label1.setAttribute('for', 'programat_' + i);
                label1.textContent = 'نوعیت';
                var input1 = document.createElement('input');
                input1.type = 'text';
                input1.id = 'programat_' + i;
                input1.name = 'programat_' + i;
                input1.className = 'programat-input';
                input1.placeholder = 'پروگرام کی نوعیت لکھیں';
                input1.value = existingNames[i] || '';
                group1.appendChild(label1);
                group1.appendChild(input1);
                
                var group2 = document.createElement('div');
                group2.className = 'form-group';
                var label2 = document.createElement('label');
                label2.setAttribute('for', 'programat_count_' + i);
                label2.textContent = 'حاضری';
                var input2 = document.createElement('input');
                input2.type = 'number';
                input2.min = '0';
                input2.id = 'programat_count_' + i;
                input2.name = 'programat_count_' + i;
                input2.className = 'programat-count-input';
                input2.placeholder = '0';
                input2.value = existingCounts[i] || '';
                group2.appendChild(label2);
                group2.appendChild(input2);
                
                row.appendChild(group1);
                row.appendChild(group2);
                container.appendChild(row);
            }
        }

        function renderAtifalProgramatFields() {
            var countInput = document.getElementById('atifal_programat_count');
            var container = document.getElementById('atifal-programat-fields-container');
            var count = parseInt(countInput.value) || 0;
            if (count > 50) {
                count = 50;
                countInput.value = 50;
            }

            var existingNames = {};
            var existingCounts = {};
            for (var i = 1; i <= 50; i++) {
                var nameInput = document.getElementById('atifal_nauyiat_' + i);
                var countInputField = document.getElementById('atifal_programat_count_' + i);
                if (nameInput) existingNames[i] = nameInput.value;
                if (countInputField) existingCounts[i] = countInputField.value;
            }

            container.innerHTML = '';
            for (var i = 1; i <= count; i++) {
                var row = document.createElement('div');
                row.className = 'form-row programat-row';

                var group1 = document.createElement('div');
                group1.className = 'form-group';
                var label1 = document.createElement('label');
                label1.setAttribute('for', 'atifal_nauyiat_' + i);
                label1.textContent = 'نوعیت';
                var input1 = document.createElement('input');
                input1.type = 'text';
                input1.id = 'atifal_nauyiat_' + i;
                input1.name = 'atifal_nauyiat_' + i;
                input1.className = 'atifal-programat-input';
                input1.placeholder = 'پروگرام کی نوعیت لکھیں';
                input1.value = existingNames[i] || '';
                group1.appendChild(label1);
                group1.appendChild(input1);

                var group2 = document.createElement('div');
                group2.className = 'form-group';
                var label2 = document.createElement('label');
                label2.setAttribute('for', 'atifal_programat_count_' + i);
                label2.textContent = 'حاضری';
                var input2 = document.createElement('input');
                input2.type = 'number';
                input2.min = '0';
                input2.id = 'atifal_programat_count_' + i;
                input2.name = 'atifal_programat_count_' + i;
                input2.className = 'atifal-programat-count-input';
                input2.placeholder = '0';
                input2.value = existingCounts[i] || '';
                group2.appendChild(label2);
                group2.appendChild(input2);

                row.appendChild(group1);
                row.appendChild(group2);
                container.appendChild(row);
            }
        }

        document.addEventListener('DOMContentLoaded', function () {
            var prefixes = [
                'alaqajat', 'halqajat', 'halqajat_ward', 'block_code', 'nizam_e_fajar', 'awaami_committee',
                'arkaan', 'umeedwaran', 'karkunan', 'hangami', 'muawanin', 'mutayyin_afrad', 'member'
            ];
            
            prefixes.forEach(setupIkhtitaamListeners);
            
            setTimeout(function() {
                prefixes.forEach(function(prefix) {
                    updateIkhtitaam(prefix);
                });
            }, 100);
            
            setTimeout(function() {
                prefixes.forEach(function(prefix) {
                    updateIkhtitaam(prefix);
                });
            }, 300);
            
            setTimeout(function() {
                prefixes.forEach(function(prefix) {
                    updateIkhtitaam(prefix);
                });
            }, 500);
            
            setTimeout(function() {
                prefixes.forEach(function(prefix) {
                    updateIkhtitaam(prefix);
                });
            }, 1000);

            var youthCountInput = document.getElementById('youth_programat_count');
            if (youthCountInput && youthCountInput.value) {
                renderProgramatFields();
            }
            
            var atifalCountInput = document.getElementById('atifal_programat_count');
            if (atifalCountInput && atifalCountInput.value) {
                renderAtifalProgramatFields();
            }
            
            document.addEventListener('input', function(e) {
                var inputName = e.target.name;
                if (inputName && (inputName.includes('_start') || inputName.includes('_izafa') || inputName.includes('_kami'))) {
                    var prefix = inputName.replace('_start', '').replace('_izafa', '').replace('_kami', '');
                    updateIkhtitaam(prefix);
                }
            });
            
            document.addEventListener('change', function(e) {
                var inputName = e.target.name;
                if (inputName && (inputName.includes('_start') || inputName.includes('_izafa') || inputName.includes('_kami'))) {
                    var prefix = inputName.replace('_start', '').replace('_izafa', '').replace('_kami', '');
                    updateIkhtitaam(prefix);
                }
            });
        });

        document.addEventListener('DOMContentLoaded', function () {
            var form = document.querySelector('.report-form');
            if (form) {
                form.addEventListener('submit', function () {
                    var prefixes = [
                        'alaqajat', 'halqajat', 'halqajat_ward', 'block_code', 'nizam_e_fajar', 'awaami_committee',
                        'arkaan', 'umeedwaran', 'karkunan', 'hangami', 'muawanin', 'mutayyin_afrad', 'member'
                    ];
                    prefixes.forEach(function(prefix) {
                        var aghaazInput = document.querySelector('[name="' + prefix + '_start"]');
                        var izafaInput = document.querySelector('[name="' + prefix + '_izafa"]');
                        var kamiInput = document.querySelector('[name="' + prefix + '_kami"]');
                        var ikhtitaamInput = document.querySelector('[name="' + prefix + '_ikhtitaam"]');
                        var aghaaz = aghaazInput && aghaazInput.value !== '' ? parseInt(aghaazInput.value) : 0;
                        var izafa = izafaInput && izafaInput.value !== '' ? parseInt(izafaInput.value) : 0;
                        var kami = kamiInput && kamiInput.value !== '' ? parseInt(kamiInput.value) : 0;
                        if (ikhtitaamInput) {
                            ikhtitaamInput.value = aghaaz + izafa - kami;
                        }
                    });
                });
            }
        });

        // Character counter function
        function updateCharCounter(textarea, counterId) {
            const counter = document.getElementById(counterId);
            const currentLength = textarea.value.length;
            const maxLength = textarea.maxLength;
            counter.textContent = `${currentLength} / ${maxLength}`;
            
            // Change color based on usage
            if (currentLength > maxLength * 0.8) {
                counter.style.color = '#e74c3c';
            } else if (currentLength > maxLength * 0.6) {
                counter.style.color = '#f39c12';
            } else {
                counter.style.color = '#7f8c8d';
            }
        }

        // Initialize character counters
        document.addEventListener('DOMContentLoaded', function () {
            var haqTextarea = document.getElementById('haq-do-karachi');
            var koiTextarea = document.getElementById('koi-or-bat');
            if (haqTextarea) updateCharCounter(haqTextarea, 'char-counter-haq');
            if (koiTextarea) updateCharCounter(koiTextarea, 'char-counter-koi');
            
            // Handle disabled quarter and year fields for form submission
            var quarterSelect = document.getElementById('quarter');
            var yearSelect = document.getElementById('year');
            
            if (quarterSelect && quarterSelect.disabled) {
                // Create hidden inputs to ensure values are submitted
                var quarterHidden = document.createElement('input');
                quarterHidden.type = 'hidden';
                quarterHidden.name = 'quarter';
                quarterHidden.value = quarterSelect.value;
                quarterSelect.parentNode.appendChild(quarterHidden);
            }
            
            if (yearSelect && yearSelect.disabled) {
                // Create hidden inputs to ensure values are submitted
                var yearHidden = document.createElement('input');
                yearHidden.type = 'hidden';
                yearHidden.name = 'year';
                yearHidden.value = yearSelect.value;
                yearSelect.parentNode.appendChild(yearHidden);
            }
            
            // Handle readonly aghaz fields for form submission
            var readonlyInputs = document.querySelectorAll('input[readonly]');
            readonlyInputs.forEach(function(input) {
                if (input.name && input.name.includes('_start')) {
                    // Create hidden inputs to ensure readonly values are submitted
                    var hiddenInput = document.createElement('input');
                    hiddenInput.type = 'hidden';
                    hiddenInput.name = input.name;
                    hiddenInput.value = input.value;
                    input.parentNode.appendChild(hiddenInput);
                }
            });
            
            // Also handle form submission to ensure disabled fields are included
            var form = document.getElementById('historicalForm');
            if (form) {
                form.addEventListener('submit', function(e) {
                });
            }
        });
    </script>
</body>
</html>